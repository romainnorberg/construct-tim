{{ tinymce_init() }}

<script>
  var debug=true;
  function callback_tinymce_init(editor) {

  }

  function tinymce_button_imageupload(){
    log('call imageupload');

    var imageuploadForm = $("#tinymce_fileform");
    var imageuploadInput = $("#tinymce_fileform input[type='file']");

    imageuploadInput.unbind();
    imageuploadInput.click();

    imageuploadInput.change(function(){
      log('change');
      if (files = imageuploadInput.prop('files')) {
        if (files.length == 0) {
          log('no file selected');
        } else {
          log('file(s) selected');

          var formdata = (window.FormData) ? new FormData(imageuploadForm[0]) : null;
          var data = (formdata !== null) ? formdata : imageuploadForm.serialize();

          $.ajax({
            url: imageuploadForm.attr('action'),
            type: imageuploadForm.attr('method'),
            contentType: false,
            processData: false,
            dataType: 'json',
            data: data,
            success: function (response) {
              log(response);
            }
          });
        }
      }
    });
  }

  function log(t){
    if(debug) console.log(t);
  }
</script>
